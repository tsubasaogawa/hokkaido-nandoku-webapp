# Feature Specification: AIによるクイズ選択肢の自動生成

**Author:** Gemini
**Status:** Draft
**Created:** 2025-11-10
**Last Updated:** 2025-11-10

## 1. Description

クイズの誤った選択肢を、外部の生成AIサービスを利用して動的に生成する機能。これにより、単なるダミーの選択肢ではなく、正解と紛らわしい、より質の高い選択肢を提供し、ユーザーのクイズ体験を向上させる。

## 2. User Scenarios & Testing

### 2.1. クイズ挑戦者が紛らわしい選択肢に挑戦する

- **Given** ユーザーがクイズページを開き、
- **When** 新しい問題が表示されると、
- **Then** 正解の選択肢1つと、AIが生成した不正解の選択肢3つがランダムな順序で表示される。
- **And** 不正解の選択肢は、正解の地名と関連性があり、混同しやすいものになっている。

### 2.2. 外部サービス障害時もクイズが継続できる

- **Given** 外部の生成AIサービスが利用できない状態で、
- **When** ユーザーに新しい問題が表示されると、
- **Then** システムはエラーを適切に処理し、あらかじめ用意されたダミーの選択肢を表示する。
- **And** ユーザーはクイズを中断することなく継続できる。

## 3. Functional Requirements

### 3.1. 選択肢の動的生成

- FR1: 新しい問題が表示されるたびに、外部の生成AIサービスに対して、正解の地名に基づいた不正解の選択肢を3つ生成するようリクエストを送信しなければならない。
- FR2: システムは、AIサービスから受け取った3つの不正解の選択肢と、1つの正解の選択肢を結合しなければならない。
- FR3: 結合された4つの選択肢は、ユーザーに表示される前にランダムにシャッフルされなければならない。

### 3.2. フォールバック処理

- FR4: 外部の生成AIサービスへのリクエストが失敗した場合、またはタイムアウトした場合は、事前に定義された静的なダミーの選択肢を代わりに表示しなければならない。
- FR5: 外部サービスとの通信エラーはログに記録されなければならないが、ユーザーにはエラーメッセージを表示してはならない。

## 4. Success Criteria

- SC1: クイズの全問題の99%以上で、動的に生成された選択肢が正常に表示される。
- SC2: 外部サービス障害時、選択肢が表示されるまでの平均応答時間の悪化が5%未満であること。
- SC3: ユーザーアンケートにより、選択肢の質が向上したと回答したユーザーが80%以上であること。（アンケート機能は本機能の範囲外）

## 5. Assumptions

- A1: 外部の生成AIサービスの利用に関するAPIキーや認証情報は、安全に管理・設定されているものとする。
- A2: 生成AIサービスの利用にはコストが発生することを前提とする。
- A3: 生成される選択肢の品質や正確性は、外部サービスに依存する。

## 6. Out of Scope

- ユーザーが選択肢の生成モデルや難易度を選択する機能。
- 生成された選択肢の内容を人間がレビューまたは修正する仕組み。
- A/Bテストなどによる、選択肢の品質評価と改善サイクル。